<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactored Invoice Management Demo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div id="app">
        <div class="max-w-6xl mx-auto space-y-6">
            <!-- Header -->
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Invoice Management</h2>
                    <p class="text-sm text-gray-600">Create and manage invoices from export receipts</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="bg-white shadow rounded-lg">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8 px-6">
                        <button @click="activeTab = 'confirmed-exports'" :class="tabClass('confirmed-exports')">
                            Approved Export Receipts
                        </button>
                        <button @click="activeTab = 'my-invoices'" :class="tabClass('my-invoices')">My Invoices</button>
                    </nav>
                </div>

                <!-- Approved Export Receipts Tab -->
                <div v-if="activeTab === 'confirmed-exports'" class="p-6">
                    <ApprovedExportReceipts
                        :my-invoices="myInvoices"
                        @create-invoice="handleCreateInvoice"
                        @error="showMessage"
                    />
                </div>

                <!-- My Invoices Tab -->
                <div v-if="activeTab === 'my-invoices'" class="p-6">
                    <MyInvoices
                        :my-invoices="myInvoices"
                        @view-invoice="handleViewInvoice"
                        @edit-invoice="handleEditInvoice"
                        @delete-invoice="handleDeleteInvoice"
                        @error="showMessage"
                        @invoices-loaded="handleInvoicesLoaded"
                    />
                </div>
            </div>

            <!-- Message -->
            <div v-if="message" :class="messageClass" class="p-4 rounded-lg">{{ message }}</div>

            <!-- Component Info -->
            <div class="bg-green-50 rounded-lg p-4">
                <h4 class="font-medium text-green-900 mb-2">Refactored Components</h4>
                <div class="text-sm text-green-700">
                    <p><strong>ApprovedExportReceipts.vue:</strong> Handles approved export receipts display and search</p>
                    <p><strong>MyInvoices.vue:</strong> Handles invoices display, search, and filtering</p>
                    <p><strong>InvoiceManagement.vue:</strong> Main container with tabs and modal management</p>
                    <p><strong>Benefits:</strong> Cleaner code, better separation of concerns, reusable components</p>
                    <p><strong>Current Tab:</strong> {{ activeTab }}</p>
                    <p><strong>Total Invoices:</strong> {{ myInvoices.length }}</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        // Mock ApprovedExportReceipts Component
        const ApprovedExportReceipts = {
            props: ['myInvoices'],
            emits: ['create-invoice', 'error'],
            template: `
                <div>
                    <div class="mb-4">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Approved Export Receipts Ready for Invoice</h3>
                        <p class="text-sm text-gray-600">Select an approved export receipt to create an invoice</p>
                    </div>

                    <!-- Search -->
                    <div class="mb-4">
                        <input
                            v-model="search"
                            type="text"
                            placeholder="Search by receipt number or customer name..."
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                    </div>

                    <!-- Export Receipts Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Receipt #</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="receipt in filteredReceipts" :key="receipt.id">
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ receipt.receiptNumber }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-900">{{ receipt.customerName }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ receipt.customerPhone }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ receipt.date }}</td>
                                    <td class="px-6 py-4 text-sm">
                                        <button
                                            @click="$emit('create-invoice', receipt)"
                                            :disabled="hasInvoice(receipt.id)"
                                            :class="[
                                                'px-3 py-1 rounded text-sm',
                                                hasInvoice(receipt.id)
                                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                    : 'bg-blue-600 text-white hover:bg-blue-700'
                                            ]"
                                        >
                                            {{ hasInvoice(receipt.id) ? 'Invoice Created' : 'Create Invoice' }}
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            setup(props, { emit }) {
                const search = ref('');
                
                // Mock data
                const receipts = ref([
                    { id: 1, receiptNumber: 'ER-2024-0001', customerName: 'John Doe', customerPhone: '+1-555-1234', date: '2024-01-15' },
                    { id: 2, receiptNumber: 'ER-2024-0002', customerName: 'Jane Smith', customerPhone: '+1-555-5678', date: '2024-01-16' },
                    { id: 3, receiptNumber: 'ER-2024-0003', customerName: 'Bob Johnson', customerPhone: '+1-555-9012', date: '2024-01-17' },
                ]);

                const filteredReceipts = computed(() => {
                    if (!search.value) return receipts.value;
                    const s = search.value.toLowerCase();
                    return receipts.value.filter(r => 
                        r.receiptNumber.toLowerCase().includes(s) ||
                        r.customerName.toLowerCase().includes(s)
                    );
                });

                const hasInvoice = (receiptId) => {
                    return props.myInvoices.some(inv => inv.exportReceiptId === receiptId);
                };

                return { search, filteredReceipts, hasInvoice };
            }
        };

        // Mock MyInvoices Component
        const MyInvoices = {
            props: ['myInvoices'],
            emits: ['view-invoice', 'edit-invoice', 'delete-invoice', 'error', 'invoices-loaded'],
            template: `
                <div>
                    <div class="mb-4">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">My Invoices</h3>
                        <p class="text-sm text-gray-600">Manage your created invoices</p>
                    </div>

                    <!-- Search and Filter -->
                    <div class="mb-4 flex gap-4">
                        <input
                            v-model="search"
                            type="text"
                            placeholder="Search by invoice number or customer name..."
                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <select
                            v-model="statusFilter"
                            class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="">All Status</option>
                            <option value="pending_review">Pending Review</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>

                    <!-- Invoices Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Invoice #</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="invoice in filteredInvoices" :key="invoice.id">
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ invoice.invoiceNumber }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-900">{{ invoice.customerName }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-900">${{ invoice.amount.toFixed(2) }}</td>
                                    <td class="px-6 py-4 text-sm">
                                        <span :class="getStatusClass(invoice.status)" class="px-2 py-1 rounded-full text-xs font-medium">
                                            {{ invoice.status }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm space-x-2">
                                        <button @click="$emit('view-invoice', invoice)" class="text-blue-600 hover:text-blue-900">View</button>
                                        <button @click="$emit('edit-invoice', invoice)" class="text-green-600 hover:text-green-900">Edit</button>
                                        <button @click="$emit('delete-invoice', invoice)" class="text-red-600 hover:text-red-900">Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `,
            setup(props, { emit }) {
                const search = ref('');
                const statusFilter = ref('');

                const filteredInvoices = computed(() => {
                    let filtered = props.myInvoices;
                    if (search.value) {
                        const s = search.value.toLowerCase();
                        filtered = filtered.filter(inv => 
                            inv.invoiceNumber.toLowerCase().includes(s) ||
                            inv.customerName.toLowerCase().includes(s)
                        );
                    }
                    if (statusFilter.value) {
                        filtered = filtered.filter(inv => inv.status === statusFilter.value);
                    }
                    return filtered;
                });

                const getStatusClass = (status) => {
                    const classes = {
                        pending_review: 'bg-yellow-100 text-yellow-800',
                        approved: 'bg-green-100 text-green-800',
                        rejected: 'bg-red-100 text-red-800',
                    };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                };

                return { search, statusFilter, filteredInvoices, getStatusClass };
            }
        };

        createApp({
            components: {
                ApprovedExportReceipts,
                MyInvoices
            },
            setup() {
                const activeTab = ref('confirmed-exports');
                const message = ref('');
                const messageType = ref('success');

                // Mock invoices data
                const myInvoices = ref([
                    { id: 1, invoiceNumber: 'INV-2024-0001', customerName: 'John Doe', amount: 1500, status: 'pending_review', exportReceiptId: 1 },
                    { id: 2, invoiceNumber: 'INV-2024-0002', customerName: 'Jane Smith', amount: 2300, status: 'approved', exportReceiptId: 2 },
                ]);

                const tabClass = (tab) => [
                    'py-4 px-1 border-b-2 font-medium text-sm',
                    activeTab.value === tab
                        ? 'border-blue-500 text-blue-600'
                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                ];

                const messageClass = computed(() => {
                    return messageType.value === 'success'
                        ? 'bg-green-50 text-green-800 border border-green-200'
                        : 'bg-red-50 text-red-800 border border-red-200';
                });

                const handleCreateInvoice = (receipt) => {
                    const newInvoice = {
                        id: myInvoices.value.length + 1,
                        invoiceNumber: `INV-2024-${String(myInvoices.value.length + 1).padStart(4, '0')}`,
                        customerName: receipt.customerName,
                        amount: Math.random() * 2000 + 500,
                        status: 'pending_review',
                        exportReceiptId: receipt.id
                    };
                    myInvoices.value.push(newInvoice);
                    showMessage('Invoice created successfully!', 'success');
                    activeTab.value = 'my-invoices';
                };

                const handleViewInvoice = (invoice) => {
                    showMessage(`Viewing invoice ${invoice.invoiceNumber}`, 'success');
                };

                const handleEditInvoice = (invoice) => {
                    showMessage(`Editing invoice ${invoice.invoiceNumber}`, 'success');
                };

                const handleDeleteInvoice = (invoice) => {
                    if (confirm('Are you sure you want to delete this invoice?')) {
                        const index = myInvoices.value.findIndex(inv => inv.id === invoice.id);
                        if (index > -1) {
                            myInvoices.value.splice(index, 1);
                            showMessage('Invoice deleted successfully!', 'success');
                        }
                    }
                };

                const handleInvoicesLoaded = (invoices) => {
                    myInvoices.value = invoices;
                };

                const showMessage = (text, type = 'success') => {
                    message.value = text;
                    messageType.value = type;
                    setTimeout(() => {
                        message.value = '';
                    }, 3000);
                };

                return {
                    activeTab,
                    myInvoices,
                    message,
                    messageClass,
                    tabClass,
                    handleCreateInvoice,
                    handleViewInvoice,
                    handleEditInvoice,
                    handleDeleteInvoice,
                    handleInvoicesLoaded,
                    showMessage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
