<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Management with Pagination Demo</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div id="app">
        <div class="max-w-6xl mx-auto space-y-6">
            <!-- Header -->
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Invoice Management with Pagination</h2>
                    <p class="text-sm text-gray-600">Create and manage invoices from export receipts</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="bg-white shadow rounded-lg">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8 px-6">
                        <button @click="activeTab = 'confirmed-exports'" :class="tabClass('confirmed-exports')">
                            Approved Export Receipts
                        </button>
                        <button @click="activeTab = 'my-invoices'" :class="tabClass('my-invoices')">My Invoices</button>
                    </nav>
                </div>

                <!-- Approved Export Receipts Tab -->
                <div v-if="activeTab === 'confirmed-exports'" class="p-6">
                    <ApprovedExportReceiptsWithPagination
                        :my-invoices="myInvoices"
                        @create-invoice="handleCreateInvoice"
                        @error="showMessage"
                    />
                </div>

                <!-- My Invoices Tab -->
                <div v-if="activeTab === 'my-invoices'" class="p-6">
                    <MyInvoicesWithPagination
                        :my-invoices="paginatedInvoices"
                        @view-invoice="handleViewInvoice"
                        @edit-invoice="handleEditInvoice"
                        @delete-invoice="handleDeleteInvoice"
                        @error="showMessage"
                        @invoices-loaded="handleInvoicesLoaded"
                    />
                </div>
            </div>

            <!-- Message -->
            <div v-if="message" :class="messageClass" class="p-4 rounded-lg">{{ message }}</div>

            <!-- Pagination Info -->
            <div class="bg-blue-50 rounded-lg p-4">
                <h4 class="font-medium text-blue-900 mb-2">Pagination Features</h4>
                <div class="text-sm text-blue-700">
                    <p><strong>Items per page:</strong> 8 (fixed for both components)</p>
                    <p><strong>Current Tab:</strong> {{ activeTab }}</p>
                    <p><strong>Total Invoices:</strong> {{ allInvoices.length }}</p>
                    <p><strong>Features:</strong> Server-side pagination, debounced search (500ms), auto-reset to page 1</p>
                    <p><strong>Navigation:</strong> Previous/Next buttons only</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        // Mock ApprovedExportReceipts Component with Pagination
        const ApprovedExportReceiptsWithPagination = {
            props: ['myInvoices'],
            emits: ['create-invoice', 'error'],
            template: `
                <div>
                    <div class="mb-4">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">Approved Export Receipts Ready for Invoice</h3>
                        <p class="text-sm text-gray-600">Select an approved export receipt to create an invoice</p>
                    </div>

                    <!-- Search -->
                    <div class="mb-4 flex gap-4">
                        <input
                            v-model="search"
                            @input="debounceSearch"
                            type="text"
                            placeholder="Search by receipt number or customer name..."
                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <button @click="resetSearch" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Reset</button>
                    </div>

                    <!-- Export Receipts Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Receipt #</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="receipt in paginatedReceipts" :key="receipt.id">
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ receipt.receiptNumber }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-900">{{ receipt.customerName }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ receipt.customerPhone }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ receipt.date }}</td>
                                    <td class="px-6 py-4 text-sm">
                                        <button
                                            @click="$emit('create-invoice', receipt)"
                                            :disabled="hasInvoice(receipt.id)"
                                            :class="[
                                                'px-3 py-1 rounded text-sm',
                                                hasInvoice(receipt.id)
                                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                    : 'bg-blue-600 text-white hover:bg-blue-700'
                                            ]"
                                        >
                                            {{ hasInvoice(receipt.id) ? 'Invoice Created' : 'Create Invoice' }}
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div v-if="totalPages > 1" class="px-6 py-4 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-gray-700">
                                Showing {{ (currentPage - 1) * 8 + 1 }} to {{ Math.min(currentPage * 8, filteredReceipts.length) }} of {{ filteredReceipts.length }} results
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-700">Page {{ currentPage }} of {{ totalPages }}</span>
                                <div class="flex space-x-2">
                                    <button @click="changePage(currentPage - 1)" :disabled="currentPage === 1" class="px-3 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
                                    <button @click="changePage(currentPage + 1)" :disabled="currentPage === totalPages" class="px-3 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            setup(props, { emit }) {
                const search = ref('');
                const currentPage = ref(1);
                const searchTimeout = ref(null);
                
                // Mock data - 25 receipts
                const allReceipts = ref([]);
                for (let i = 1; i <= 25; i++) {
                    allReceipts.value.push({
                        id: i,
                        receiptNumber: `ER-2024-${String(i).padStart(4, '0')}`,
                        customerName: `Customer ${i}`,
                        customerPhone: `+1-555-${String(1000 + i)}`,
                        date: `2024-01-${String(i).padStart(2, '0')}`
                    });
                }

                const filteredReceipts = computed(() => {
                    if (!search.value) return allReceipts.value;
                    const s = search.value.toLowerCase();
                    return allReceipts.value.filter(r => 
                        r.receiptNumber.toLowerCase().includes(s) ||
                        r.customerName.toLowerCase().includes(s)
                    );
                });

                const totalPages = computed(() => Math.ceil(filteredReceipts.value.length / 8));

                const paginatedReceipts = computed(() => {
                    const start = (currentPage.value - 1) * 8;
                    return filteredReceipts.value.slice(start, start + 8);
                });

                const debounceSearch = () => {
                    if (searchTimeout.value) clearTimeout(searchTimeout.value);
                    searchTimeout.value = setTimeout(() => {
                        currentPage.value = 1;
                    }, 500);
                };

                const resetSearch = () => {
                    search.value = '';
                    currentPage.value = 1;
                };

                const changePage = (page) => {
                    if (page >= 1 && page <= totalPages.value) {
                        currentPage.value = page;
                    }
                };

                const hasInvoice = (receiptId) => {
                    return props.myInvoices.some(inv => inv.exportReceiptId === receiptId);
                };

                return { 
                    search, currentPage, filteredReceipts, totalPages, paginatedReceipts,
                    debounceSearch, resetSearch, changePage, hasInvoice 
                };
            }
        };

        // Mock MyInvoices Component with Pagination
        const MyInvoicesWithPagination = {
            props: ['myInvoices'],
            emits: ['view-invoice', 'edit-invoice', 'delete-invoice', 'error', 'invoices-loaded'],
            template: `
                <div>
                    <div class="mb-4">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">My Invoices</h3>
                        <p class="text-sm text-gray-600">Manage your created invoices</p>
                    </div>

                    <!-- Search and Filter -->
                    <div class="mb-4 flex gap-4">
                        <input
                            v-model="search"
                            @input="debounceSearch"
                            type="text"
                            placeholder="Search by invoice number or customer name..."
                            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <select v-model="statusFilter" @change="onStatusChange" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">All Status</option>
                            <option value="pending_review">Pending Review</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <button @click="resetFilters" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">Reset</button>
                    </div>

                    <!-- Invoices Table -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Invoice #</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="invoice in props.myInvoices" :key="invoice.id">
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">{{ invoice.invoiceNumber }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-900">{{ invoice.customerName }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-900">${{ invoice.amount.toFixed(2) }}</td>
                                    <td class="px-6 py-4 text-sm">
                                        <span :class="getStatusClass(invoice.status)" class="px-2 py-1 rounded-full text-xs font-medium">
                                            {{ invoice.status }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm space-x-2">
                                        <button @click="$emit('view-invoice', invoice)" class="text-blue-600 hover:text-blue-900">View</button>
                                        <button @click="$emit('edit-invoice', invoice)" class="text-green-600 hover:text-green-900">Edit</button>
                                        <button @click="$emit('delete-invoice', invoice)" class="text-red-600 hover:text-red-900">Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div v-if="totalPages > 1" class="px-6 py-4 border-t border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-gray-700">
                                Showing {{ (currentPage - 1) * 8 + 1 }} to {{ Math.min(currentPage * 8, filteredInvoices.length) }} of {{ filteredInvoices.length }} results
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-700">Page {{ currentPage }} of {{ totalPages }}</span>
                                <div class="flex space-x-2">
                                    <button @click="changePage(currentPage - 1)" :disabled="currentPage === 1" class="px-3 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
                                    <button @click="changePage(currentPage + 1)" :disabled="currentPage === totalPages" class="px-3 py-2 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            setup(props, { emit }) {
                const search = ref('');
                const statusFilter = ref('');
                const currentPage = ref(1);
                const searchTimeout = ref(null);

                // Mock all invoices for filtering
                const allInvoices = ref([]);
                for (let i = 1; i <= 30; i++) {
                    const statuses = ['pending_review', 'approved', 'rejected'];
                    allInvoices.value.push({
                        id: i,
                        invoiceNumber: `INV-2024-${String(i).padStart(4, '0')}`,
                        customerName: `Customer ${i}`,
                        amount: Math.random() * 2000 + 500,
                        status: statuses[Math.floor(Math.random() * statuses.length)],
                        exportReceiptId: i
                    });
                }

                const filteredInvoices = computed(() => {
                    let filtered = allInvoices.value;
                    if (search.value) {
                        const s = search.value.toLowerCase();
                        filtered = filtered.filter(inv => 
                            inv.invoiceNumber.toLowerCase().includes(s) ||
                            inv.customerName.toLowerCase().includes(s)
                        );
                    }
                    if (statusFilter.value) {
                        filtered = filtered.filter(inv => inv.status === statusFilter.value);
                    }
                    return filtered;
                });

                const totalPages = computed(() => Math.ceil(filteredInvoices.value.length / 8));

                const debounceSearch = () => {
                    if (searchTimeout.value) clearTimeout(searchTimeout.value);
                    searchTimeout.value = setTimeout(() => {
                        currentPage.value = 1;
                        updatePaginatedInvoices();
                    }, 500);
                };

                const onStatusChange = () => {
                    currentPage.value = 1;
                    updatePaginatedInvoices();
                };

                const resetFilters = () => {
                    search.value = '';
                    statusFilter.value = '';
                    currentPage.value = 1;
                    updatePaginatedInvoices();
                };

                const changePage = (page) => {
                    if (page >= 1 && page <= totalPages.value) {
                        currentPage.value = page;
                        updatePaginatedInvoices();
                    }
                };

                const updatePaginatedInvoices = () => {
                    const start = (currentPage.value - 1) * 8;
                    const paginatedData = filteredInvoices.value.slice(start, start + 8);
                    emit('invoices-loaded', paginatedData);
                };

                const getStatusClass = (status) => {
                    const classes = {
                        pending_review: 'bg-yellow-100 text-yellow-800',
                        approved: 'bg-green-100 text-green-800',
                        rejected: 'bg-red-100 text-red-800',
                    };
                    return classes[status] || 'bg-gray-100 text-gray-800';
                };

                // Initialize
                updatePaginatedInvoices();

                return { 
                    search, statusFilter, currentPage, filteredInvoices, totalPages,
                    debounceSearch, onStatusChange, resetFilters, changePage, getStatusClass 
                };
            }
        };

        createApp({
            components: {
                ApprovedExportReceiptsWithPagination,
                MyInvoicesWithPagination
            },
            setup() {
                const activeTab = ref('confirmed-exports');
                const message = ref('');
                const messageType = ref('success');

                // Mock invoices data
                const allInvoices = ref([]);
                const paginatedInvoices = ref([]);

                const tabClass = (tab) => [
                    'py-4 px-1 border-b-2 font-medium text-sm',
                    activeTab.value === tab
                        ? 'border-blue-500 text-blue-600'
                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                ];

                const messageClass = computed(() => {
                    return messageType.value === 'success'
                        ? 'bg-green-50 text-green-800 border border-green-200'
                        : 'bg-red-50 text-red-800 border border-red-200';
                });

                const handleCreateInvoice = (receipt) => {
                    const newInvoice = {
                        id: allInvoices.value.length + 1,
                        invoiceNumber: `INV-2024-${String(allInvoices.value.length + 1).padStart(4, '0')}`,
                        customerName: receipt.customerName,
                        amount: Math.random() * 2000 + 500,
                        status: 'pending_review',
                        exportReceiptId: receipt.id
                    };
                    allInvoices.value.push(newInvoice);
                    showMessage('Invoice created successfully!', 'success');
                    activeTab.value = 'my-invoices';
                };

                const handleViewInvoice = (invoice) => {
                    showMessage(`Viewing invoice ${invoice.invoiceNumber}`, 'success');
                };

                const handleEditInvoice = (invoice) => {
                    showMessage(`Editing invoice ${invoice.invoiceNumber}`, 'success');
                };

                const handleDeleteInvoice = (invoice) => {
                    if (confirm('Are you sure you want to delete this invoice?')) {
                        const index = allInvoices.value.findIndex(inv => inv.id === invoice.id);
                        if (index > -1) {
                            allInvoices.value.splice(index, 1);
                            showMessage('Invoice deleted successfully!', 'success');
                        }
                    }
                };

                const handleInvoicesLoaded = (invoices) => {
                    paginatedInvoices.value = invoices;
                };

                const showMessage = (text, type = 'success') => {
                    message.value = text;
                    messageType.value = type;
                    setTimeout(() => {
                        message.value = '';
                    }, 3000);
                };

                // Initialize with some invoices
                const myInvoices = ref([
                    { id: 1, invoiceNumber: 'INV-2024-0001', customerName: 'Customer 1', amount: 1500, status: 'pending_review', exportReceiptId: 1 },
                    { id: 2, invoiceNumber: 'INV-2024-0002', customerName: 'Customer 2', amount: 2300, status: 'approved', exportReceiptId: 2 },
                ]);
                allInvoices.value = [...myInvoices.value];

                return {
                    activeTab,
                    allInvoices,
                    myInvoices,
                    paginatedInvoices,
                    message,
                    messageClass,
                    tabClass,
                    handleCreateInvoice,
                    handleViewInvoice,
                    handleEditInvoice,
                    handleDeleteInvoice,
                    handleInvoicesLoaded,
                    showMessage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
